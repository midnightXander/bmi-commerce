{% extends "core/base.html" %}
{% load static %}


{% block content %}
<main class="container mx-auto mt-8 px-4">
    {% if  not request.user.is_authenticated %}
    <section id="partnerLoginForm" class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-8 animate-fadeIn">
        <h2 class="text-3xl font-bold text-[#5A0B29] mb-6">Connectez-vous a votre compte partenaire BMI</h2>
        <form  class="space-y-4" action="{% url 'partner:login' %}" method="post" >
            {% csrf_token %}
            <div class="messages">
                {% for message in messages %}
                    <h5 class="message {{message.tags}}">{{message}}</h5>
                {% endfor %}
            <div>

            <div class="mb-4">
                <label for="email" class="block text-gray-700 mb-2">Email professionnel</label>
                <input type="email" id="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            <div class="mb-4">
                <label for="password" class="block text-gray-700 mb-2">Mot de passe</label>
                <input type="password" id="password" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            
            <p class="mt-4 text-center">
                devenir partenaire? <a href="#" onclick="switchForm()" class="text-[#5A0B29] hover:underline">Créer un compte partenaire</a>
            </p>
            <div>
                <button type="submit" class="w-full bg-[#5A0B29] text-white font-bold py-3 px-4 rounded-md hover:bg-opacity-90 transition duration-300">Se Connecter</button>
            </div>
        </form>
    </section>

    <section id="partnerRegisterForm" class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-8 animate-fadeIn hidden">
        <h2 class="text-3xl font-bold text-[#5A0B29] mb-6">Créer votre compte partenaire BMI</h2>
        <form action="{% url 'partner:register' %}" method="post" class="space-y-4">
            {% csrf_token %}
            <div class="messages">
                {% for message in messages %}
                    <h5 class="message {{messages.tags}}">{{message}}</h5>
                {% endfor %}
            <div>
            <div class="mb-4" >
                <label for="companyName" class="block text-gray-700 mb-2">Nom de l'entreprise</label>
                <input type="text" id="companyName" name="companyName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            <div class="mb-4">
                <label for="r_email" class="block text-gray-700 mb-2">Email professionnel</label>
                <input type="email" id="r_email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            <div class="mb-4">
                <label for="password1" class="block text-gray-700 mb-2">Mot de passe</label>
                <input type="password1" id="password1" name="password1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            <div class="mb-4">
                <label for="confirmPassword" class="block text-gray-700 mb-2">Confirmer le mot de passe</label>
                <input type="password" id="confirmPassword" name="password2" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            <div class="mb-4">
                <label for="phone_number" class="block text-gray-700 mb-2">Numero de téléphone</label>
                <input type="text" id="phone_number" name="phone_number" placeholder="entrer le numero de telephone de l'entreprise avec l'identifiant du pays" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
            </div>
            <div class="mb-4">
                <label for="city" class="block text-gray-700 mb-2">Ou vous trouvez vous?</label>
                <select id="city" name="city" class="w-full border p-2 rounded-lg">
                    <option value="">Votre pays</option>
                    <option>Cameroun</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="industry" class="block text-gray-700 mb-2">Quel type de produit vendez vous?</label>
                <select id="industry" name="product_type" class=" border w-full p-2 rounded-lg">
                    <option value="">Selectionnez une catégorie</option>
                    <option>Alimentaire</option>
                </select>
            </div>
            <p class="mt-4 text-center">
                Vous avez déja un compte? <a href="#" onclick="switchForm()" class="text-[#5A0B29] hover:underline">Connectez-vous</a>
            </p>
            <div>
                <button type="submit" class="w-full bg-[#5A0B29] text-white font-bold py-3 px-4 rounded-md hover:bg-opacity-90 transition duration-300">Créer le compte</button>
            </div>
        </form>
    </section>
    {% else %}
    <h2 class="text-3xl font-bold text-[#5A0B29] mb-6">Tableau de Bord {{provider.user.username}}</h2>
    
    
   
    
    <section class="items  mb-8 animate-fadeIn">
            <h3 class="text-2xl font-semibold mb-4">Vos Produits</h3>
            <div class="overflow-x-auto">
                <table class="w-full bg-white shadow-md rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="p-3 text-left">Nom du Produit</th>
                            <th class="p-3 text-left">Prix</th>
                            <th class="p-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productList">
                        <!-- Les produits seront ajoutés ici dynamiquement -->
                    </tbody>
                </table>
            </div>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-md animate-fadeIn">
            <h3 class="text-2xl font-semibold mb-4">Ajouter un Nouveau Produit</h3>
            <form id="addProductForm" enctype="multipart/form-data" method="post" action = "{% url 'partner:add_product' %}" class="space-y-4">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="productName" class="block text-gray-700 mb-2">Nom du Produit</label>
                    <input type="text" id="productName" name="productName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
                </div>
                <div class="mb-4">
                    <label for="productPrice" class="block text-gray-700 mb-2">Prix (€)</label>
                    <input type="number" id="productPrice" name="productPrice" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
                </div>
                <div class="mb-4">
                    <label for="productDescription" class="block text-gray-700 mb-2">Description</label>
                    <textarea id="productDescription" name="productDescription" placeholder="Plus votre description est détaillé, plus vous avez des chances de vendre" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]"></textarea>
                </div>

                <div class="mb-4">
                    <label for="image1" class="block text-gray-700 mb-2">Image 1(ajoutez au moins deux images)</label>
                    <input type="file" id="image1" name="image1"  required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
                    
                </div>
                <div class="mb-4">
                    <label for="image2" class="block text-gray-700 mb-2">Image 2</label>
                    <input type="file" id="image2" name="image2"  required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#5A0B29]">
                </div>
                <div>
                    <span class="bg-[#5A0B29] text-white font-bold py-2 px-4 rounded-md hover:bg-opacity-90 hover:cursor-pointer transition duration-300"><i class="fas fa-plus" ></i></span>
                </div>
                


                <div>
                    <button type="submit" class="bg-[#5A0B29] text-white font-bold py-2 px-4 rounded-md hover:bg-opacity-90 transition duration-300">Ajouter le Produit</button>
                </div>
            </form>
        </section>



    {% endif %}
</main>

<script>
    function switchForm(){
        const loginForm = document.querySelector("#partnerLoginForm")
        const registerForm = document.querySelector("#partnerRegisterForm")
        
        registerForm.classList.toggle('hidden');
        loginForm.classList.toggle('hidden');
    }
</script>
<script>
    // Simuler des produits existants
    let products = [
        { id: 1, name: "Avoine", price: 14900 },
        { id: 2, name: "Pack de chips", price: 10000 },
        { id: 3, name: "Plantains", price: 8500 }
    ];

    

    const productList = document.getElementById('productList');
    const addProductForm = document.getElementById('addProductForm');

    function displayProducts() {

        $.ajax({
            url: '/partner/products/{{provider.id}}',
            type: 'GET',
            beforeSend: function(){

            },
            success : function(res){
                if(res.status == 'success'){
                    const products = res.items
                    productList.innerHTML = '';
                    products.forEach(product => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="p-3">${product.name}</td>
                            <td class="p-3">${product.price.toFixed(2)} XAF</td>
                            <td class="p-3">
                                <button onclick="editProduct(${product.id})" class="bg-blue-500 text-white px-2 py-1 rounded mr-2">Modifier</button>
                                <button onclick="deleteProduct(${product.id})" class="bg-red-500 text-white px-2 py-1 rounded">Supprimer</button>
                            </td>
                        `;
                        productList.appendChild(row);
                    });
                }else{
                    // console.log(res)
                }
            },
            complete: function(){

            },
            error:  function(jqXHR, textstatus, errorThrown){
                console.log(textstatus, errorThrown)
            }
        })

       
    }

    function addProduct(name, price) {
        const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
        products.push({ id: newId, name, price });
        displayProducts();
    }

    function editProduct(id) {
        const product = products.find(p => p.id === id);
        if (product) {
            const newName = prompt("Nouveau nom du produit:", product.name);
            const newPrice = prompt("Nouveau prix du produit:", product.price);
            if (newName && newPrice) {
                product.name = newName;
                product.price = parseFloat(newPrice);
                displayProducts();
            }
        }
    }

    function deleteProduct(id) {
        if (confirm("Êtes-vous sûr de vouloir supprimer ce produit ?")) {
            products = products.filter(p => p.id !== id);
            displayProducts();
        }
    }

   

    
    if(productList){
        displayProducts(products);
    }
    
</script>

{% endblock content %}